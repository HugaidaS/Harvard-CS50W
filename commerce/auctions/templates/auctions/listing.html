{% extends "auctions/layout.html" %}

{% block body %}
    <h2>{{ listing.title }}</h2>
    <!-- If current user is an author, show edit button -->
    {% if user.is_authenticated %}
        {% if isUserAuthor %}
            <a href="{% url 'edit' listing.id %}">Edit Listing</a>
        {% endif %}
        <!-- Add or remove the listing from watchList -->
        {% if isOnWatchList %}
            <a href="{% url 'remove_from_watchlist' listing.id %}">Remove from Watchlist</a>
        {% else %}
            <a href="{% url 'add_to_watchlist' listing.id %}">Add to Watchlist</a>
        {% endif %}
    {% endif %}
    <p>Author: {{ listing.author }}</p>
    <p>Status: {{ listing.status }}</p>
    <img src="{{ listing.image_url }}" alt="Image of {{ listing.title }}">
    <p>Category: {{ listing.category }}</p>
    <p>Description: {{ listing.description }}</p>
    <p>Starting bid: ${{ listing.starting_bid }}</p>
    <p>Current bid: ${{ current_bid }}</p>
    <!--Creation date -->
    <p>Created on: {{ listing.creation_date }}</p>

    {% if user.is_authenticated %}
        <!-- If the listing is active, show the bid form -->
        {% if listing.status == 'active' %}
            <form action="{% url 'bid' listing.id %}" method="post">
                {% csrf_token %}
                <input type="number" name="bid" step="0.01" min="{{ listing.current_bid }}" placeholder="Place a bid">
                <input type="submit" value="Place Bid">
            </form>
        {% endif %}
    {% endif %}

    <!-- Comment section , comment form and comments block below -->
    {% if user.is_authenticated %}
        <form action="{% url 'comment' listing.id %}" method="post">
            {% csrf_token %}
            <textarea name="comment" rows="4" cols="50" placeholder="Add a comment"></textarea>
            <input type="submit" value="Add Comment">
        </form>
    {% endif %}

    {% if comments %}
        <h3>Comments</h3>
        <ul>
            {% for comment in comments %}
                <li>{{ comment.author }}: {{ comment.comment }} - {{ comment.creation_date }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No comments yet.</p>
    {% endif %}

{% endblock %}
